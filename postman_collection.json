{"openapi":"3.1.0","info":{"title":"Diet Recommendation API","version":"1.0.0"},"paths":{"/health":{"get":{"summary":"Health","description":"Return basic health status and database connectivity.\n\nRaises:\n    DatabaseError: If database connection fails.","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/create-user-with-plan":{"post":{"tags":["users"],"summary":"Create User With Plan","description":"Create a new user and generate both daily and weekly meal plans.\n\nThis endpoint computes nutrition targets using the `NutritionCalculator`,\npersists the new user, generates both daily and weekly plans with\n`RecommendationEngine`, saves all plans, and returns user + plan details.\n\nArgs:\n    payload: `UserCreateRequest` with user profile info and use_csv flag.\n    db: SQLAlchemy session (write) injected by dependency.\n\nReturns:\n    `UserWithMealPlanResponse` containing user, daily plan, and weekly plan.\n    \nRaises:\n    InsufficientDataError: If no meals available in database or CSV.\n    DatabaseError: If database operation fails.","operationId":"create_user_with_plan_api_create_user_with_plan_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreateRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserWithMealPlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/create-user-with-weekly-plan":{"post":{"tags":["users"],"summary":"Create User With Weekly Plan","description":"Create a new user and generate a 7-day weekly meal plan.\n\nThis endpoint computes nutrition targets, persists the user, generates\na weekly meal plan with variety, saves all 7 daily plans, and returns\nuser + weekly plan details.\n\nArgs:\n    payload: `UserCreateRequest` with user profile info.\n    db: SQLAlchemy session (write) injected by dependency.\n\nReturns:\n    `WeeklyMealPlanResponse` containing the user and 7-day meal plan.\n    \nRaises:\n    InsufficientDataError: If no meals available in database.\n    DatabaseError: If database operation fails.","operationId":"create_user_with_weekly_plan_api_create_user_with_weekly_plan_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreateRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/WeeklyMealPlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users-with-plans":{"get":{"tags":["users"],"summary":"Get Users With Plans","description":"Return a paginated list of users together with their latest meal plan.\n\nArgs:\n    limit (int): Maximum number of users to return.\n    skip (int): Number of users to skip (pagination).\n    db: Read-only SQLAlchemy session injected by dependency.\n\nReturns:\n    `AllUsersResponse` containing total_users and list of user objects.","operationId":"get_users_with_plans_api_users_with_plans_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AllUsersResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/meals":{"get":{"tags":["meals"],"summary":"List Meals","description":"Return all meals as a list of `MealDetail` objects.\n\nArgs:\n    db: Read-only SQLAlchemy session injected by dependency.\n\nReturns:\n    List of meal objects in `MealDetail` Pydantic format.","operationId":"list_meals_api_meals_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/MealDetail"},"type":"array","title":"Response List Meals Api Meals Get"}}}}}}},"/api/recommendations/{plan_id}/feedback":{"post":{"tags":["recommendations"],"summary":"Submit Feedback","description":"Record a user's feedback for a meal within a meal plan.\n\nValidates that the user and meal exist, persists a Feedback record, and\nreturns the stored feedback details.\n\nRaises:\n    NotFoundError: If user or meal not found in database.","operationId":"submit_feedback_api_recommendations__plan_id__feedback_post","parameters":[{"name":"plan_id","in":"path","required":true,"schema":{"type":"integer","title":"Plan Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackCreateRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recommendations/meal/{meal_id}/similar":{"get":{"tags":["recommendations"],"summary":"Get Similar Meals","description":"Return the top-k meals most similar to the given meal id.\n\nUses the content-based recommender to rank meals by cosine similarity and\nreturns serialized `SimilarMeal` objects including the similarity score.\n\nRaises:\n    NotFoundError: If meal not found in database.","operationId":"get_similar_meals_api_recommendations_meal__meal_id__similar_get","parameters":[{"name":"meal_id","in":"path","required":true,"schema":{"type":"integer","title":"Meal Id"}},{"name":"top_k","in":"query","required":false,"schema":{"type":"integer","default":5,"title":"Top K"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SimilarMeal"},"title":"Response Get Similar Meals Api Recommendations Meal  Meal Id  Similar Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/diet/train":{"post":{"tags":["diet"],"summary":"Train","description":"Train the diet recommendation model from CSV and return metrics.","operationId":"train_api_diet_train_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TrainRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TrainResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/diet/predict":{"post":{"tags":["diet"],"summary":"Predict","description":"Predict diet recommendation from a user id or an inline profile.\n\nRaises:\n    ValidationError: If neither user_id nor profile provided.\n    NotFoundError: If user_id provided but user not found.\n    ModelNotTrainedError: If ML model not trained yet.\n    InsufficientDataError: If no meals available.","operationId":"predict_api_diet_predict_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PredictRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PredictResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AllUsersResponse":{"properties":{"total_users":{"type":"integer","title":"Total Users"},"users":{"items":{"type":"object"},"type":"array","title":"Users"}},"type":"object","required":["total_users","users"],"title":"AllUsersResponse","description":"Response wrapper for returning a list of users and total count."},"FeedbackCreateRequest":{"properties":{"user_id":{"type":"integer","title":"User Id","description":"ID of the user providing feedback","examples":[1]},"plan_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Plan Id","description":"ID of the meal plan (optional)","examples":[5]},"meal_id":{"type":"integer","title":"Meal Id","description":"ID of the meal being rated","examples":[10]},"rating":{"type":"integer","maximum":5.0,"minimum":1.0,"title":"Rating","description":"Rating from 1 (poor) to 5 (excellent)","examples":[4]}},"type":"object","required":["user_id","meal_id","rating"],"title":"FeedbackCreateRequest","description":"Payload for submitting a feedback rating for a meal."},"FeedbackResponse":{"properties":{"id":{"type":"integer","title":"Id"},"user_id":{"type":"integer","title":"User Id"},"plan_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Plan Id"},"meal_id":{"type":"integer","title":"Meal Id"},"rating":{"type":"integer","title":"Rating"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["id","user_id","plan_id","meal_id","rating","created_at"],"title":"FeedbackResponse","description":"Stored feedback record returned after persisting."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MealDetail":{"properties":{"id":{"type":"integer","title":"Id"},"name":{"type":"string","title":"Name"},"meal_type":{"type":"string","title":"Meal Type"},"calories":{"type":"number","title":"Calories"},"protein":{"type":"number","title":"Protein"},"carbs":{"type":"number","title":"Carbs"},"fat":{"type":"number","title":"Fat"},"ingredients":{"items":{"type":"string"},"type":"array","title":"Ingredients"}},"type":"object","required":["id","name","meal_type","calories","protein","carbs","fat","ingredients"],"title":"MealDetail","description":"Representation of a meal in responses."},"PredictRequest":{"properties":{"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"profile":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Profile"},"use_csv":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Use Csv","default":false},"preference":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preference"},"weekly":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Weekly","default":false}},"type":"object","title":"PredictRequest","description":"Request schema for diet prediction endpoint.\n\nAttributes:\n    user_id: Optional user ID to load profile from database.\n    profile: Optional inline profile dictionary with user attributes.\n    use_csv: If True, source meals from CSV fixtures instead of DB.\n    preference: Explicit dietary preference (e.g., 'veg', 'vegan', 'keto').\n    weekly: If True, generate 7-day weekly plan instead of single day."},"PredictResponse":{"properties":{"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"age":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Age"},"height":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Height"},"weight":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Weight"},"bmi":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Bmi"},"gender":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Gender"},"activity_level":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Activity Level"},"health_goal":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Health Goal"},"dietary_preference":{"type":"string","title":"Dietary Preference"},"target_calories":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Target Calories"},"target_macros":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Target Macros"},"diet_recommendation":{"type":"string","title":"Diet Recommendation"},"confidence":{"type":"number","title":"Confidence"},"probabilities":{"additionalProperties":{"type":"number"},"type":"object","title":"Probabilities"},"recommended_meals":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Recommended Meals"},"daily_plan":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Daily Plan"},"weekly_plan":{"anyOf":[{"items":{"type":"object"},"type":"array"},{"type":"null"}],"title":"Weekly Plan"}},"type":"object","required":["dietary_preference","diet_recommendation","confidence","probabilities"],"title":"PredictResponse","description":"Response schema containing prediction results and recommendations.\n\nAttributes:\n    user_id: User ID if prediction was for an existing user.\n    name: User name.\n    age: User age.\n    height: User height in cm.\n    weight: User weight in kg.\n    bmi: Calculated BMI.\n    gender: User gender.\n    activity_level: Physical activity level.\n    health_goal: User's health goal.\n    dietary_preference: Dietary preference.\n    target_calories: Calculated target calories.\n    target_macros: Target macronutrient goals (protein, carbs, fat).\n    diet_recommendation: Predicted diet category label.\n    confidence: Confidence score for the prediction.\n    probabilities: Dictionary mapping each class to its probability.\n    recommended_meals: List of recommended meal objects.\n    daily_plan: Generated daily meal plan with breakfast, lunch, dinner.\n    weekly_plan: Optional 7-day weekly meal plan."},"SimilarMeal":{"properties":{"id":{"type":"integer","title":"Id"},"name":{"type":"string","title":"Name"},"meal_type":{"type":"string","title":"Meal Type"},"calories":{"type":"number","title":"Calories"},"protein":{"type":"number","title":"Protein"},"carbs":{"type":"number","title":"Carbs"},"fat":{"type":"number","title":"Fat"},"dietary_tags":{"items":{"type":"string"},"type":"array","title":"Dietary Tags","default":[]},"ingredients":{"items":{"type":"string"},"type":"array","title":"Ingredients"},"score":{"type":"number","title":"Score"}},"type":"object","required":["id","name","meal_type","calories","protein","carbs","fat","ingredients","score"],"title":"SimilarMeal","description":"Similar meal with an attached similarity score."},"TrainRequest":{"properties":{"csv_path":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Csv Path"}},"type":"object","title":"TrainRequest","description":"Request schema for training the diet model.\n\nAttributes:\n    csv_path: Optional path to CSV file. Uses default dataset if None."},"TrainResponse":{"properties":{"model_path":{"type":"string","title":"Model Path"},"accuracy":{"type":"number","title":"Accuracy"},"classes":{"items":{},"type":"array","title":"Classes"}},"type":"object","required":["model_path","accuracy","classes"],"title":"TrainResponse","description":"Response schema containing training results.\n\nAttributes:\n    model_path: Path where the trained model was saved.\n    accuracy: Model accuracy score on test set.\n    classes: List of predicted class labels."},"UserCreateRequest":{"properties":{"name":{"type":"string","minLength":1,"title":"Name","description":"User's full name","examples":["John Doe"]},"age":{"type":"integer","maximum":100.0,"minimum":18.0,"title":"Age","description":"Age in years (18-100)","examples":[30]},"height":{"type":"number","maximum":250.0,"minimum":100.0,"title":"Height","description":"Height in centimeters (100-250)","examples":[175.0]},"weight":{"type":"number","maximum":300.0,"minimum":30.0,"title":"Weight","description":"Weight in kilograms (30-300)","examples":[75.0]},"gender":{"type":"string","title":"Gender","description":"Gender (male/female)","examples":["male"]},"activity_level":{"type":"string","title":"Activity Level","description":"Activity level: sedentary, lightly_active, moderately_active, very_active, extremely_active","examples":["moderately_active"]},"dietary_preference":{"type":"string","title":"Dietary Preference","description":"Dietary preference: balanced, keto, vegetarian, vegan, paleo, mediterranean, high-protein","examples":["balanced"]},"health_goal":{"type":"string","title":"Health Goal","description":"Health goal: weight_loss, muscle_gain, maintain","examples":["maintain"]},"allergies":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Allergies","description":"List of food allergies","default":[],"examples":[["peanuts","shellfish"]]},"use_csv":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Use Csv","description":"If true, source meals from CSV fixtures instead of database","default":false,"examples":[false]}},"type":"object","required":["name","age","height","weight","gender","activity_level","dietary_preference","health_goal"],"title":"UserCreateRequest","description":"Request payload for creating a user profile."},"UserWithMealPlanResponse":{"properties":{"name":{"type":"string","title":"Name"},"age":{"type":"integer","title":"Age"},"height":{"type":"number","title":"Height"},"weight":{"type":"number","title":"Weight"},"bmi":{"type":"number","title":"Bmi"},"gender":{"type":"string","title":"Gender"},"activity_level":{"type":"string","title":"Activity Level"},"health_goal":{"type":"string","title":"Health Goal"},"dietary_preference":{"type":"string","title":"Dietary Preference"},"target_calories":{"type":"number","title":"Target Calories"},"target_macros":{"type":"object","title":"Target Macros"},"daily_plan":{"type":"object","title":"Daily Plan"},"weekly_plan":{"items":{"type":"object"},"type":"array","title":"Weekly Plan"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["name","age","height","weight","bmi","gender","activity_level","health_goal","dietary_preference","target_calories","target_macros","daily_plan","weekly_plan","created_at"],"title":"UserWithMealPlanResponse","description":"Response returned after creating a user with a generated meal plan."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"WeeklyMealPlanResponse":{"properties":{"name":{"type":"string","title":"Name"},"age":{"type":"integer","title":"Age"},"height":{"type":"number","title":"Height"},"weight":{"type":"number","title":"Weight"},"bmi":{"type":"number","title":"Bmi"},"gender":{"type":"string","title":"Gender"},"activity_level":{"type":"string","title":"Activity Level"},"health_goal":{"type":"string","title":"Health Goal"},"dietary_preference":{"type":"string","title":"Dietary Preference"},"target_calories":{"type":"number","title":"Target Calories"},"target_macros":{"type":"object","title":"Target Macros"},"weekly_plan":{"items":{"type":"object"},"type":"array","title":"Weekly Plan","description":"List of 7 daily meal plans"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["name","age","height","weight","bmi","gender","activity_level","health_goal","dietary_preference","target_calories","target_macros","weekly_plan","created_at"],"title":"WeeklyMealPlanResponse","description":"Response containing a 7-day weekly meal plan."}}}}